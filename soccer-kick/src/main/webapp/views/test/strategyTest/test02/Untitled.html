<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="/soccer-kick/css/commons/header.css" rel="stylesheet" type="text/css">
<link href="/soccer-kick/lib/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css">
<link href="/soccer-kick/css/commons/my-bootstrap.css" rel="stylesheet" type="text/css">
<link href="/soccer-kick/css/commons/profile.css" rel="stylesheet" type="text/css">
<link href="/soccer-kick/css/commons/userForm.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="flexslider.css" type="text/css" media="screen" />

<title>Welcome</title>
<style type="text/css">
.drag {
	width: 32px;
	height: 32px;
	border : 2px solid blue;
	border-radius: 1em;
	-webkit-transform: translate(0px, 0px);
	transform: translate(0px, 0px);
	box-shadow: 2px 2px 2px gray;
}

#drag-me::before {
	content: "#" attr(id);
	font-weight: bold;
}

.drag2 {
	background: red;
}

#replacementPlayers img {
	border-radius : 0.3em;
	box-shadow: 2px 2px 2px lightgray;
	border : 2px solid yellow;
}
</style>
</head>
<body>
	<div id="header" class="my-header navbar navbar-default navbar-static-top"></div>
	<div class="section">
		<div class="container">
			<div class="row">
				<!-- !!!!!!!!!!!!working in progress!!!!!!!!!!! -->
				<hr>
				<div id="playParent" class="col-md-12">
					<div id="playGround" style="box-shadow: 10px 10px 10px gray; border-radius:0.5em;">
						<img src="sField.png" class="img-responsive">
					</div>
				</div>
			</div>
				<hr>
				
			<!-- Replacement Player Area -->
			<div id="replacementPlayerArea" class="row" style="display: none;">
				<div id="main" role="main">
      				<section class="slider" style=" padding-left: 50px;background:#6AD368; padding-right: 50px; margin-left:30px; margin-right:30px;">
        				<div class="flexslider carousel" style="background:#6AD368; padding:20px;">
        					<div class="row" style="text-align: center;">
          						<div class="col-md-12">
          							<h4 style="display: inline;">Change Players!</h4>
            						<a id="closeReplacementPlayerAreaBtn" class="btn btn-success btn-xs">Close</a>
          						</div>
        					</div>
          					<ul class="slides" id="replacementPlayers"><br>
            					<li><img src="images/t1.png" /></li>
  	    						<li><img src="images/t2.png" /></li>
  	    						<li><img src="images/t3.png" /></li>
  	    						<li><img src="images/t4.png" /></li>
								<li><img src="images/t5.png" /></li>
            					<li><img src="images/t6.png" /></li>
								<li><img src="images/t7.png" /></li>
            					<li><img src="images/t8.png" /></li>
            					<li><img src="images/t9.png" /></li>
            					<li><img src="images/t10.png" /></li>
            					<li><img src="images/t11.png" /></li>
            					<li><img src="images/t12.png" /></li>
          					</ul>
        				</div>
      				</section>
    			</div>
			</div>
			
			<!-- submit Area -->
			<div class="row">
				<div class="col-md-12">
					<form class="form-horizontal" role="form">
						<div class="form-group">
							<div class="col-sm-10 col-sm-offset-1">
								<div class="btn-group btn-group-sm">
									<a class="btn btn-primary btn-xs dropdown-toggle"
										data-toggle="dropdown"> Fomation <span
										class="fa fa-caret-down"></span></a>
									<ul class="dropdown-menu" style="text-align: center;">
										<li>
											<a class="btn btn-block btn-xs disabled">3 Back Fomations</a>
											<a id="fomation3232">3-2-3-2</a> <a id="fomation3142">3-1-4-2</a><a id="fomation3223">3-2-2-3</a>
											<a class="btn btn-block btn-xs disabled">4 Back Fomations</a>
											<a id="fomation442">4-4-2</a><a id="fomation4312">4-3-1-2</a><a id="fomation4231">4-2-3-1</a>
											<a id="fomation4213">4-2-1-3</a><a id="fomation4321">4-3-2-1</a>
											<a id="fomation4123">4-1-2-3</a><a id="fomation433">4-3-3</a>
											<a class="btn btn-block btn-xs disabled">5 Back Fomation</a>
											<a id="fomation5221">5-2-2-1</a></li>
									</ul>
								</div>
								<div class="btn-group btn-group-sm">
									<a class="btn btn-danger btn-xs dropdown-toggle"
										data-toggle="dropdown"> Fomation <span
										class="fa fa-caret-down"></span></a>
									<ul class="dropdown-menu" style="text-align: center;">
										<li>
											<a class="btn btn-block btn-xs disabled">3 Back Fomations</a>
											<a id="fomation2-3232">3-2-3-2</a> <a id="fomation2-3142">3-1-4-2</a><a id="fomation2-3223">3-2-2-3</a>
											<a class="btn btn-block btn-xs disabled">4 Back fomation2-s</a>
											<a id="fomation2-442">4-4-2</a><a id="fomation2-4312">4-3-1-2</a><a id="fomation2-4231">4-2-3-1</a>
											<a id="fomation2-4213">4-2-1-3</a><a id="fomation2-4321">4-3-2-1</a>
											<a id="fomation2-4123">4-1-2-3</a><a id="fomation2-433">4-3-3</a>
											<a class="btn btn-block btn-xs disabled">5 Back fomation2-</a>
											<a id="fomation2-5221">5-2-2-1</a></li>
									</ul>
								</div>
								<button class="btn btn-default dropdown-toggle jscolor {valueElement:'chosen-value', onFineChange:'setTextColor(this)'}"
										data-toggle="dropdown"><span
										class="fa fa-caret-down"></span></button>
								<a class="btn btn-default" id="changePlayerBtn">Change Player</a>
								<a class="btn btn-default" id="captureBtn">Capture</a>
								<input type="submit" class="btn btn-default" value="Submit">
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-10 col-sm-offset-1">
								<input type="text" class="form-control" id="strategyTitle"
									placeholder="Title">
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-10 col-sm-offset-1">
								<textarea class="form-control2" rows="12" id="strategyContent"
									placeholder="Content"></textarea>
							</div>
						</div>
						<div class="form-group" id="imageFiles"></div>
					</form>
				</div>
			</div>
			
			<div class="row">
          		<div id="capturedImages" class="col-sm-10 col-sm-offset-1" style="border: 1px solid skyblue; border-radius:5px; padding: 10px;">
            		<div style="text-align: center;"><h4>Captured Images Area</h4></div>
          		</div>
        	</div>
		</div>
	</div>
	
	<footer id="footer" class="section"></footer>

	<div class="modal fade" id="profileModal"></div>
	
	<script src="/soccer-kick/lib/jquery/jquery.js"></script>
	<script src="/soccer-kick/js/common.js"></script>
	<script src="/soccer-kick/lib/blueimp-file-upload/js/vendor/jquery.ui.widget.js"></script>
	<script src="/soccer-kick/lib/blueimp-file-upload/js/jquery.iframe-transport.js"></script>
	<script src="/soccer-kick/lib/blueimp-file-upload/js/jquery.fileupload.js"></script>
	<script src="/soccer-kick/js/commons/headerFooterModal.js"></script>
	<script src="/soccer-kick/lib/bootstrap/js/bootstrap.js"></script>
	<script
		src="/soccer-kick/lib/jquery-throttle-debounce/jquery.ba-throttle-debounce.min.js"></script>
	<script src="/soccer-kick/lib/jquery-ui/jquery-ui.js"></script>
	<script
		src="/soccer-kick/lib/jquery-smooth-scroll/jquery.smooth-scroll.js"></script>
	<script src="/soccer-kick/lib/interact/interact.js"></script>
	<script src="/soccer-kick/lib/html2canvas/html2canvas.js"></script>
	<script src="js/jscolor.js"></script>
	<script>
		// target elements with the "draggable" class
		interact('.draggable').draggable({
			// enable inertial throwing
			inertia : true,
			// keep the element within the area of it's parent
			restrict : {
				restriction : "parent",
				endOnly : true,
				elementRect : {
					top : 0,
					left : 0,
					bottom : 1,
					right : 1
				}
			},
			// enable autoScroll
			autoScroll : true,

			// call this function on every dragmove event
			onmove : dragMoveListener,
		});

		function dragMoveListener(event) {
			var target = event.target,
			// keep the dragged position in the data-x/data-y attributes
			x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx, y = (parseFloat(target
					.getAttribute('data-y')) || 0)
					+ event.dy;

			// translate the element
			target.style.webkitTransform = target.style.transform = 'translate('
					+ x + 'px, ' + y + 'px)';

			// update the posiion attributes
			target.setAttribute('data-x', x);
			target.setAttribute('data-y', y);
		}

		// this is used later in the resizing and gesture demos
		window.dragMoveListener = dragMoveListener;
	</script>
	<script>
		//capture
		$("#captureBtn").click(function() {
			html2canvas(
				$("#playGround"),
				{
					useCORS : true,
					proxy : '/etc/proxy_image',
					onrendered : function(canvas) {
						var image = canvas.toDataURL().toString();
						$("#capturedImages").html($("#capturedImages").html() + '<span><img src=' + image + ' style="width: 118px; height: 78px; padding:5px;"></span>');
						//reset canvas
						var canvas = document.getElementById('playGroundCanvas');
					    var context = canvas.getContext('2d');
					    context.clearRect(0, 0, canvas.width, canvas.height);
					    context.beginPath();
				}});
			return false;
		});
	</script>
	<script>
		window.onload = function() {
			initGround();
			window.addEventListener('resize', reCanvasResize);
		}
		$("#test111").click(function() {
			basicLineColor = "red";
			painter();
		});
		
		
		var basicLineColor = "black";
		function setTextColor(picker) {
			basicLineColor = '#' + picker.toString();
			painter();
		}
		var isPress = false;
		var painter = function() {
			var canvas = document.getElementById("playGroundCanvas");
			var context = canvas.getContext("2d");
			context.strokeStyle = basicLineColor;
			context.lineWidth = 3;
			$(canvas).on({
				mousedown : function(event) {
					isPress = true;
					var pos = $(this).offset();
					var x = event.pageX - pos.left;
					var y = event.pageY - pos.top;

					context.beginPath();
					context.moveTo(x, y);
					
				},
				mouseup : function(event) {
					isPress = false;
				},
				mousemove : function(event) {
					var pos = $(this).offset();
					var x = event.pageX - pos.left;
					var y = event.pageY - pos.top;

					if(isPress) {
						context.lineTo(x, y);
						context.stroke();
					}
				}
			});
		};
		
		/////////////////////////////////////////////////////////////////////////////
		/////////////////////////////////////////////////////////////////////////////
		var playGroundWidth, playGroundHeight, tmpPlayGroundWidth, tmpPlayGroundHeight;
		//initial fomation : 3-2-3-2
		var fomationInfo = "3-2-3-2";
		var fomationInfo2 = "2-3-2-3";
		
		var initGround = function() {
			playGroundWidth = $("#playGround").width();
			playGroundHeight = $("#playGround").height();
			$("#playGround").html("<canvas id='playGroundCanvas' width=" + playGroundWidth + " height=" + playGroundHeight + " style='border:1px solid blue; border-radius:0.5em; background-size:" + playGroundWidth + "px " + playGroundHeight + "px; background-image: url(\"sField.png\"); box-shadow: 10px 10px 10px gray;'></canvas>")
							.css({"width" : playGroundWidth, "height" : playGroundHeight});
			playerArranger(0);
			playerArranger2(12);
			painter();
		}
		
		var reCanvasResize = function() {
			tmpPlayGroundWidth = playGroundWidth, tmpPlayGroundHeight = playGroundHeight;
			$("#playParent").empty().html("<div id='playGround'><img src='sField.png' class='img-responsive'></div>");
			playGroundWidth = $("#playGround").width();
			playGroundHeight = $("#playGround").height();
			$("#playGround").html("<canvas id='playGroundCanvas' width=" + playGroundWidth + " height=" + playGroundHeight + " style='border:1px solid blue; border-radius:0.5em; background-size:" + playGroundWidth + "px " + playGroundHeight + "px; background-image: url(\"sField.png\"); box-shadow: 10px 10px 10px gray;'></canvas>")
							.css({"width" : playGroundWidth, "height" : playGroundHeight});
			playerArranger(0);
			playerArranger2(12);
			painter();
		}
		
		var playerArranger = function(index) {
			var fomation = fomationInfo.split("-");
			var playerIndex = index;
			
			ball2html(playGroundWidth / 2 - 14, -playGroundHeight / 2 - 25);
			playerIndex++;
			var div = 1;
			for(var i = - 1; i < fomation.length; i++) {
				if(i == -1) {
					player2html(playerIndex, playGroundWidth / 20, -1 * playGroundHeight / 2 - 50);
					playerIndex++;
				} else {
					for(var j = 1; j <= fomation[i]; j++) {
						player2html(
								playerIndex, 
								div * playGroundWidth / ((fomation.length + 1) * 2),  
								j * (-1 * playGroundHeight / (parseInt(fomation[i]) + 1)) + (playerIndex) * -35
						);
						playerIndex++;
					}
					div++;
				}
			}
		}
		
		var playerArranger2 = function(index) {
			var fomation = fomationInfo2.split("-");
			var playerIndex = index;
			
			var div = 1;
			for(var i = 0; i < fomation.length; i++) {
				 for(var j = 1; j <= fomation[i]; j++) {
						player2html2(
							playerIndex, 
							playGroundWidth / 2 + div * playGroundWidth / ((fomation.length + 1) * 2) - 30,  
							j * (-1 * playGroundHeight / (parseInt(fomation[i]) + 1)) + (playerIndex) * -33
						);
						playerIndex++;
					}
					div++; 
				}
			player2html2(
				playerIndex,
				playGroundWidth * 18.5 / 20,
				-1 * playGroundHeight / 2 + ((playerIndex) * -33)
			);
		}
		/////////////////////////////
		////////ball to html///////
		var ball2html = function(x, y) {
			var playerObj = "<div id='ball' class='draggable drag' data-x=" + x + " data-y=" + y + " style='transform: translate(" + x + "px, " + y + "px); background-image: url(\"ball.png\"); background-size: 100%, 100%;'></div>";
			$("#playGround").html($("#playGround").html() + playerObj);
		}
		/////////////////////////////
		////////player to html///////
		var player2html = function(playerIndex, x, y) {
			var playerObj = "<div id='player" + playerIndex + "' class='draggable drag' data-x=" + x + " data-y=" + y + " style='transform: translate(" + x + "px, " + y + "px); background-image: url(\"" + playerIndex + ".png\"); background-size: 100%, 100%;'></div>";
			$("#playGround").html($("#playGround").html() + playerObj);
		}
		var player2html2 = function(playerIndex, x, y) {
			var playerObj = "<div id='player" + playerIndex + "' class='draggable drag drag2' data-x=" + x + " data-y=" + y + " style='transform: translate(" + x + "px, " + y + "px); background-image: url(\"devil.png\"); background-size: 100%, 100%;'></div>";
			$("#playGround").html($("#playGround").html() + playerObj);
		}
		///////////////////////////////////////////////
		////////////event for formation buttons/////////
		$("#fomation3232").click(function() {
			fomationInfo = "3-2-3-2";
			initGround();
		});
		$("#fomation3142").click(function() {
			fomationInfo = "3-1-4-2";
			initGround();
		});
		$("#fomation3223").click(function() {
			fomationInfo = "3-2-2-3";
			initGround();
		});
		$("#fomation442").click(function() {
			fomationInfo = "4-4-2";
			initGround();
		});
		$("#fomation4312").click(function() {
			fomationInfo = "4-3-1-2";
			initGround();
		});
		$("#fomation4231").click(function() {
			fomationInfo = "4-2-3-1";
			initGround();
		});
		$("#fomation4213").click(function() {
			fomationInfo = "4-2-1-3";
			initGround();
		});
		$("#fomation4321").click(function() {
			fomationInfo = "4-3-2-1";
			initGround();
		});
		$("#fomation4123").click(function() {
			fomationInfo = "4-1-2-3";
			initGround();
		});
		$("#fomation433").click(function() {
			fomationInfo = "4-3-3";
			initGround();
		});
		$("#fomation5221").click(function() {
			fomationInfo = "5-2-2-1";
			initGround();
		});
		
		$("#fomation2-3232").click(function() {
			fomationInfo2 = "2-3-2-3";
			initGround();
		});
		$("#fomation2-3142").click(function() {
			fomationInfo2 = "2-3-1-3";
			initGround();
		});
		$("#fomation2-3223").click(function() {
			fomationInfo2 = "3-2-2-3";
			initGround();
		});
		$("#fomation2-442").click(function() {
			fomationInfo2 = "2-4-4";
			initGround();
		});
		$("#fomation2-4312").click(function() {
			fomationInfo2 = "2-1-3-4";
			initGround();
		});
		$("#fomation2-4231").click(function() {
			fomationInfo2 = "1-3-2-4";
			initGround();
		});
		$("#fomation2-4213").click(function() {
			fomationInfo2 = "3-1-2-4";
			initGround();
		});
		$("#fomation2-4321").click(function() {
			fomationInfo2 = "1-2-3-4";
			initGround();
		});
		$("#fomation2-4123").click(function() {
			fomationInfo2 = "3-2-1-4";
			initGround();
		});
		$("#fomation2-433").click(function() {
			fomationInfo2 = "3-3-4";
			initGround();
		});
		$("#fomation2-5221").click(function() {
			fomationInfo2 = "1-2-2-5";
			initGround();
		});
	</script>
	
	
	
	<script defer src="jquery.flexslider.js"></script>
	<script>
	function playerEventInField() {
		objTest[replacePlayerClickCnt] = $(this);
		judge[replacePlayerClickCnt] = 0;
		$(this).css("border", "1px solid yellow");
		imgTmpPath[replacePlayerClickCnt] = $(this).css("background-image");
		var host = location.protocol + '//' + location.hostname + ':'+ location.port;
		imgTmpPath[replacePlayerClickCnt] = imgTmpPath[replacePlayerClickCnt].substring(5, imgTmpPath[replacePlayerClickCnt].length - 2);
		imgTmpPath[replacePlayerClickCnt] = imgTmpPath[replacePlayerClickCnt].substring(host.length);
		replacePlayerClickCnt++;					
		
		if(replacePlayerClickCnt == 2) {
			if(judge[0] == 0 && judge[1] == 0) {
				objTest[0].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[1] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[1].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[0] + "')", "box-shadow": "2px 2px 2px gray"});							
			} else if(judge[0] == 0 && judge[1] == 1) {
				objTest[0].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[1] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[1].attr("src", imgTmpPath[0]).css("border", "2px solid yellow");
			} else if(judge[0] == 1 && judge[1] == 0) {
				objTest[1].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[0] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[0].attr("src", imgTmpPath[1]).css("border", "2px solid yellow");
			} else {
				objTest[0].attr("src", imgTmpPath[1]).css("border", "2px solid yellow");
				objTest[1].attr("src", imgTmpPath[0]).css("border", "2px solid yellow");
			}
			replacePlayerClickCnt = 0;
		}
	}
	
	function playerEventInReplacementArea() {
		objTest[replacePlayerClickCnt] = $(this).children().eq(0);
		$(this).children().eq(0).css("border", "2px solid red");
		judge[replacePlayerClickCnt] = 1;
		imgTmpPath[replacePlayerClickCnt] = $(this).children().eq(0).attr('src');
		replacePlayerClickCnt++;
		
		if(replacePlayerClickCnt == 2) {
			if(judge[0] == 0 && judge[1] == 0) {
				objTest[0].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[1] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[1].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[0] + "')", "box-shadow": "2px 2px 2px gray"});							
			} else if(judge[0] == 0 && judge[1] == 1) {
				objTest[0].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[1] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[1].attr("src", imgTmpPath[0]).css("border", "2px solid yellow");
			} else if(judge[0] == 1 && judge[1] == 0) {
				objTest[1].css({"border" : "2px solid blue", "background-image": "url('" + imgTmpPath[0] + "')", "box-shadow": "2px 2px 2px gray"});
				objTest[0].attr("src", imgTmpPath[1]).css("border", "2px solid yellow");
			} else {
				objTest[0].attr("src", imgTmpPath[1]).css("border", "2px solid yellow");
				objTest[1].attr("src", imgTmpPath[0]).css("border", "2px solid yellow");
			}
			replacePlayerClickCnt = 0;
		}
	}
	
	var replacePlayerClickCnt = 0;
	var imgTmpPath = [];
	var objTest = [];
	var judge = [];
	(function() {
	// store the slider in a local variable
		var $window = $(window),
		flexslider = { vars:{} };
	
		// tiny helper function to add breakpoints
		function getGridSize() {
			return (window.innerWidth < 600) ? 4 :
	               (window.innerWidth < 900) ? 5 : 6;
		}
	
		$("#changePlayerBtn").click(function() {
			
			for(var i = 1; i < 12; i++) {
				$("#player" + i).removeClass("draggable").click(playerEventInField);
			}
			
			for(var i = 1; i < $("#replacementPlayers").children().length; i++) {
				$("#replacementPlayers").children().eq(i).click(playerEventInReplacementArea);
			}
			
			$("#replacementPlayerArea").show('fast', function() { 
				$('.flexslider').flexslider({
					animation: "slide",
					animationSpeed: 500,
					animationLoop: false,
					itemWidth: 210,
					itemMargin: 15,
					minItems: getGridSize(), // use function to pull in initial value
					maxItems: getGridSize(), // use function to pull in initial value
					start: function(slider){
						flexslider = slider;
					}
				});
			$("#main ol").remove();		
			});
		});
		
		// check grid size on resize event
		$window.resize(function() {
			var gridSize = getGridSize();
	        flexslider.vars.minItems = gridSize;
	        flexslider.vars.maxItems = gridSize;
		});
    }());
	
	$("#closeReplacementPlayerAreaBtn").click(function() {
		for(var i = 1; i < 12; i++) {
			$("#player" + i).addClass("draggable").off("click", playerEventInField);			
		}
		for(var i = 1; i < $("#replacementPlayers").children().length; i++) {
			$("#replacementPlayers").children().eq(i).off("click", playerEventInReplacementArea);
		}
		replacePlayerClickCnt = 0;
		$("#replacementPlayerArea").hide('fast');
	});
	</script>
</body>
</html>